{"id":"pnyx-17n","title":"Map ForumMagnum codebase structure (models, API, auth)","description":"Create a map of the ForumMagnum codebase architecture.\n\n## Why\nForumMagnum is a large, mature codebase. Understanding its structure prevents:\n- Breaking things accidentally\n- Reinventing existing functionality\n- Getting lost during customization\n\n## Areas to Map\n\n### Directory Structure\n- Where are React components?\n- Where are API routes/resolvers?\n- Where are database models?\n- Where is authentication handled?\n- Where are email templates?\n\n### Key Patterns\n- How does routing work?\n- How is state managed?\n- How are GraphQL queries structured?\n- How does the karma/voting system work?\n\n### Authentication Flow\n- How do users sign up?\n- How are sessions managed?\n- Where would we hook in ID verification?\n\n### Content Flow\n- How are posts created/edited?\n- How are comments threaded?\n- How does moderation work?\n\n## Deliverable\nCreate docs/CODEBASE_MAP.md with:\n- Directory structure overview\n- Key file locations\n- Data flow diagrams\n- Notes on what's relevant for Pnyx","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:01:44.287497Z","created_by":"James Campbell","updated_at":"2026-01-12T16:30:13.480426Z","dependencies":[{"issue_id":"pnyx-17n","depends_on_id":"pnyx-nnw","type":"blocks","created_at":"2026-01-12T16:01:55.30467Z","created_by":"James Campbell"}]}
{"id":"pnyx-1fo","title":"Identify LessWrong-specific features to remove","description":"Identify all LessWrong-specific features that should be removed or replaced for Pnyx.\n\n## Context\nForumMagnum powers both LessWrong and the EA Forum. It has many features specific to those communities that don't make sense for a general governance discussion platform.\n\n## Features to Evaluate\n\n### Likely REMOVE\n- LessWrong branding, logos, colors\n- Sequences (ordered post collections) - maybe keep for later?\n- AI Alignment-specific tags/categories\n- EA Forum-specific content\n- Petrov Day features\n- Book reviews system\n- Specific integrations (Metaculus, etc.)\n\n### Likely KEEP\n- Posts + comments (core functionality)\n- Karma/voting system\n- User profiles\n- Notifications\n- Search\n- Moderation tools\n- RSS feeds\n\n### MODIFY\n- Authentication (replace with ID verification)\n- User display (show 'First L., Country')\n- Terms of service\n- Privacy policy\n\n## Deliverable\nCreate docs/FEATURE_AUDIT.md with:\n- List of features by category (remove/keep/modify)\n- Effort estimate for each removal\n- Dependencies between features\n- Recommended removal order","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:01:44.40011Z","created_by":"James Campbell","updated_at":"2026-01-12T16:30:25.777584Z","dependencies":[{"issue_id":"pnyx-1fo","depends_on_id":"pnyx-17n","type":"blocks","created_at":"2026-01-12T16:01:55.411924Z","created_by":"James Campbell"}]}
{"id":"pnyx-2f2","title":"Write disaster recovery documentation","status":"open","priority":3,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:03:11.194942Z","created_by":"James Campbell","updated_at":"2026-01-12T16:04:16.269911Z","dependencies":[{"issue_id":"pnyx-2f2","depends_on_id":"pnyx-6gk","type":"blocks","created_at":"2026-01-12T16:03:19.541697Z","created_by":"James Campbell"}]}
{"id":"pnyx-2lr","title":"Set up ENS record for backup manifest pointer","description":"Set up ENS record to point to the latest backup manifest.\n\n## Purpose\nENS (Ethereum Name Service) provides a human-readable, decentralized pointer to the latest backup manifest. Anyone can look up 'pnyx.eth' to find the current manifest.\n\n## Why ENS\n- Decentralized (no single point of failure)\n- Human-readable (pnyx.eth vs 0x123...)\n- Updatable (can point to new manifests)\n- Widely supported\n\n## Setup Steps\n\n### 1. Register ENS Name\n- Go to https://app.ens.domains\n- Search for 'pnyx.eth'\n- Register (costs ~$5/year + gas)\n\n### 2. Set Content Hash\nENS supports IPFS and Arweave content hashes:\n```\narweave://[manifest-transaction-id]\n```\n\n### 3. Update Programmatically\n```typescript\nimport { ethers } from 'ethers';\n\nasync function updateENSRecord(manifestTxId: string) {\n  const provider = new ethers.providers.JsonRpcProvider(ETH_RPC_URL);\n  const wallet = new ethers.Wallet(PRIVATE_KEY, provider);\n  \n  const resolver = await provider.getResolver('pnyx.eth');\n  // Set content hash to arweave://[manifestTxId]\n}\n```\n\n## Alternative: DNS TXT Record\nIf ENS is too complex initially, use DNS:\n```\n_arweave.pnyx.org TXT \"arweave-tx-id-here\"\n```\n\n## Cost\n- ENS registration: ~$5/year\n- Updates: Gas fees (~$1-5 per update at normal gas prices)\n\n## Deliverable\nDocument the ENS setup and create update script.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:49.332643Z","created_by":"James Campbell","updated_at":"2026-01-12T16:32:49.260811Z","dependencies":[{"issue_id":"pnyx-2lr","depends_on_id":"pnyx-llk","type":"blocks","created_at":"2026-01-12T16:03:03.235979Z","created_by":"James Campbell"}]}
{"id":"pnyx-3pj","title":"Remove LessWrong-specific content and features","description":"Remove LessWrong-specific content and features from the codebase.\n\n## Context\nBased on the feature audit (pnyx-1fo), systematically remove features that don't belong in Pnyx.\n\n## Approach\n1. Start with the easiest, most isolated removals\n2. Test after each removal to catch breakages early\n3. Keep git commits atomic so we can revert if needed\n\n## Likely Removal Targets\n- Hardcoded LessWrong content (about pages, etc.)\n- AI Alignment-specific categories/tags\n- Sequences feature (if not needed)\n- Petrov Day code\n- Any external integrations we don't need\n- Sample/seed data\n\n## Be Careful With\n- Shared utilities that might be used elsewhere\n- CSS that affects multiple components\n- Database migrations (may need to handle existing data)\n\n## Testing\nAfter each removal:\n- Does the site still start?\n- Do existing features still work?\n- Any console errors?\n\n## Notes\n- It's okay to leave some features for later removal\n- Focus on removing things that would confuse users\n- Document any features you're unsure about","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:04.740475Z","created_by":"James Campbell","updated_at":"2026-01-12T16:30:51.710036Z","dependencies":[{"issue_id":"pnyx-3pj","depends_on_id":"pnyx-1fo","type":"blocks","created_at":"2026-01-12T16:02:24.072379Z","created_by":"James Campbell"}]}
{"id":"pnyx-3q1","title":"Implement automated daily backup scheduler","description":"Implement automated daily backup scheduler.\n\n## Purpose\nAutomatically run backups every day without manual intervention.\n\n## Implementation Options\n\n### Option 1: Node.js Cron (Recommended for simplicity)\n```typescript\nimport cron from 'node-cron';\nimport { runBackup } from './backup';\n\n// Run at 3 AM UTC every day\ncron.schedule('0 3 * * *', async () =\u003e {\n  console.log('Starting scheduled backup...');\n  try {\n    const result = await runBackup();\n    console.log('Backup completed:', result.txId);\n  } catch (error) {\n    console.error('Backup failed:', error);\n    // Alert via email/Slack/etc.\n  }\n});\n```\n\n### Option 2: External Cron (for hosted environments)\n- Railway: Use their cron job feature\n- Fly.io: Use fly machines with schedule\n- Generic: GitHub Actions on schedule\n\n## Backup Pipeline\nThe scheduler should run the full pipeline:\n1. Export MongoDB (pnyx-4ie)\n2. Package with metadata (pnyx-5ec)\n3. Upload to Arweave (pnyx-44q)\n4. Update manifest (pnyx-llk)\n5. Update ENS (pnyx-2lr) - optional, can be less frequent\n6. Clean up temp files\n\n## Monitoring\n- Log all backup attempts\n- Track success/failure rate\n- Alert on failures\n- Monitor Arweave balance\n\n## Configuration\n```\nBACKUP_SCHEDULE=0 3 * * *  # Cron expression\nBACKUP_ENABLED=true\n```\n\n## Deliverable\nCreate src/backup/scheduler.ts with scheduling logic.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:49.457464Z","created_by":"James Campbell","updated_at":"2026-01-12T16:33:01.679757Z","dependencies":[{"issue_id":"pnyx-3q1","depends_on_id":"pnyx-llk","type":"blocks","created_at":"2026-01-12T16:03:03.360293Z","created_by":"James Campbell"}]}
{"id":"pnyx-44q","title":"Upload backup archive to Arweave via Irys","description":"Upload the packaged backup archive to Arweave via Irys.\n\n## Purpose\nUpload the compressed backup archive to Arweave for permanent storage.\n\n## Implementation\n```typescript\nimport { uploadToArweave } from './arweave'; // from pnyx-zws\n\nasync function uploadBackup(archivePath: string): Promise\u003cstring\u003e {\n  const fileBuffer = await fs.readFile(archivePath);\n  \n  const receipt = await uploadToArweave(fileBuffer, {\n    tags: [\n      { name: 'Content-Type', value: 'application/gzip' },\n      { name: 'App-Name', value: 'Pnyx' },\n      { name: 'Type', value: 'backup' },\n      { name: 'Backup-Version', value: '1.0' },\n      { name: 'Timestamp', value: new Date().toISOString() },\n    ],\n  });\n  \n  return receipt.id; // Arweave transaction ID\n}\n```\n\n## Arweave Transaction ID\nThe returned ID is permanent and can be used to retrieve the backup:\n```\nhttps://arweave.net/{transactionId}\n```\n\n## Cost Considerations\n- Check balance before upload\n- Log cost of each upload for monitoring\n- Consider alerting if balance is low\n\n## Error Handling\n- Retry on temporary failures\n- Alert on permanent failures\n- Don't delete local backup until upload confirmed\n\n## Deliverable\nCreate src/backup/upload.ts with uploadBackup() function.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:42.806781Z","created_by":"James Campbell","updated_at":"2026-01-12T16:32:26.216309Z","dependencies":[{"issue_id":"pnyx-44q","depends_on_id":"pnyx-zws","type":"blocks","created_at":"2026-01-12T16:02:56.773334Z","created_by":"James Campbell"},{"issue_id":"pnyx-44q","depends_on_id":"pnyx-5ec","type":"blocks","created_at":"2026-01-12T16:02:56.876363Z","created_by":"James Campbell"}]}
{"id":"pnyx-4ie","title":"Create MongoDB export service","description":"Create a service to export the MongoDB database for backup.\n\n## Purpose\nExport all collections from MongoDB in a format suitable for backup and later restoration.\n\n## Collections to Export\nBased on schema documentation (pnyx-gt2), export:\n- users (EXCLUDING email field for privacy)\n- posts\n- comments\n- votes\n- Any other content collections\n\n## Export Format\nUse BSON (MongoDB's native format) for accuracy:\n```bash\nmongodump --uri=$MONGO_URL --out=/tmp/backup\n```\n\nOr programmatically:\n```typescript\nimport { MongoClient } from 'mongodb';\n\nasync function exportCollection(db, collectionName) {\n  const collection = db.collection(collectionName);\n  const documents = await collection.find({}).toArray();\n  \n  // For users collection, strip email\n  if (collectionName === 'users') {\n    documents.forEach(doc =\u003e delete doc.email);\n  }\n  \n  return documents;\n}\n```\n\n## Privacy: Email Exclusion\nCRITICAL: User emails must NOT be included in backups.\n- Users can recover accounts via ID re-verification\n- This is explicitly documented in our privacy model\n\n## Output Structure\n```\n/tmp/backup/\n  users.bson\n  posts.bson\n  comments.bson\n  votes.bson\n  metadata.json  # timestamps, counts, version\n```\n\n## Deliverable\nCreate src/backup/export.ts with exportDatabase() function.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:42.452026Z","created_by":"James Campbell","updated_at":"2026-01-12T16:32:05.149623Z","dependencies":[{"issue_id":"pnyx-4ie","depends_on_id":"pnyx-gt2","type":"blocks","created_at":"2026-01-12T16:02:56.57503Z","created_by":"James Campbell"}]}
{"id":"pnyx-5ec","title":"Create backup packaging with metadata and checksums","description":"Create backup packaging with metadata and integrity verification.\n\n## Purpose\nPackage the exported database files into a single archive with metadata for verification.\n\n## Package Structure\n```\npnyx-backup-2024-01-15T00-00-00Z.tar.gz\nâ”œâ”€â”€ manifest.json\nâ”œâ”€â”€ users.bson.gz\nâ”œâ”€â”€ posts.bson.gz\nâ”œâ”€â”€ comments.bson.gz\nâ””â”€â”€ votes.bson.gz\n```\n\n## Manifest Format\n```json\n{\n  \"version\": \"1.0\",\n  \"pnyx_version\": \"0.1.0\",\n  \"timestamp\": \"2024-01-15T00:00:00Z\",\n  \"checksum\": \"sha256:abc123...\",\n  \"collections\": {\n    \"users\": {\n      \"file\": \"users.bson.gz\",\n      \"count\": 1234,\n      \"checksum\": \"sha256:def456...\"\n    },\n    \"posts\": {\n      \"file\": \"posts.bson.gz\",\n      \"count\": 5678,\n      \"checksum\": \"sha256:ghi789...\"\n    }\n  }\n}\n```\n\n## Implementation\n```typescript\nimport { createGzip } from 'zlib';\nimport { createHash } from 'crypto';\nimport tar from 'tar';\n\nasync function packageBackup(exportDir: string): Promise\u003cstring\u003e {\n  // 1. Compress each .bson file\n  // 2. Calculate checksums\n  // 3. Generate manifest.json\n  // 4. Create tar.gz archive\n  // 5. Return path to final archive\n}\n```\n\n## Checksums\nUse SHA-256 for integrity verification:\n- Individual file checksums in manifest\n- Overall archive checksum\n\n## Deliverable\nCreate src/backup/package.ts with packageBackup() function.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:42.568445Z","created_by":"James Campbell","updated_at":"2026-01-12T16:32:15.137536Z","dependencies":[{"issue_id":"pnyx-5ec","depends_on_id":"pnyx-4ie","type":"blocks","created_at":"2026-01-12T16:02:56.673545Z","created_by":"James Campbell"}]}
{"id":"pnyx-689","title":"Clone ForumMagnum repository","description":"Clone the ForumMagnum repository from https://github.com/ForumMagnum/ForumMagnum\n\nThis is the open-source codebase that powers LessWrong and the EA Forum. We're forking it to build Pnyx.\n\n## Steps\n1. git clone https://github.com/ForumMagnum/ForumMagnum.git\n2. Review the README for initial setup requirements\n3. Note: This is a GPLv3 licensed project - Pnyx must also be open source\n\n## Tech Stack (from their docs)\n- TypeScript/React frontend\n- Node.js backend with GraphQL API\n- MongoDB database\n- Vulcan.js framework (heavily customized)\n\n## Resources\n- GitHub: https://github.com/ForumMagnum/ForumMagnum\n- License: GPLv3","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:01:43.91687Z","created_by":"James Campbell","updated_at":"2026-01-12T16:29:00.202465Z"}
{"id":"pnyx-6gk","title":"Implement schema migration handling for restore","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:03:11.075999Z","created_by":"James Campbell","updated_at":"2026-01-12T16:04:16.244531Z","dependencies":[{"issue_id":"pnyx-6gk","depends_on_id":"pnyx-t6m","type":"blocks","created_at":"2026-01-12T16:03:19.441862Z","created_by":"James Campbell"}]}
{"id":"pnyx-6m3","title":"Evaluate ID verification providers (Jumio, Onfido, Persona)","description":"Evaluate government ID verification providers for Pnyx user registration.\n\n## Why ID Verification\nPnyx requires real identity to participate. This:\n- Raises stakes for discourse (people think before posting)\n- Builds trust between participants\n- Matches historical precedent (signers put names on declarations)\n- Filters out trolls and bots\n\n## Providers to Evaluate\n\n### Jumio\n- Industry leader\n- Covers 200+ countries\n- Pricing: ~$2-5 per verification\n\n### Onfido\n- Strong in Europe\n- Good developer experience\n- Pricing: ~$1-3 per verification\n\n### Persona\n- Modern API, good DX\n- Flexible workflows\n- Pricing: ~$1-2 per verification\n\n### Veriff\n- Good global coverage\n- Pricing: ~$1-3 per verification\n\n## Evaluation Criteria\n1. **Coverage** - Works in countries we care about\n2. **Price** - Cost per verification\n3. **Developer Experience** - API quality, SDKs, docs\n4. **Speed** - How fast is verification?\n5. **Accuracy** - False positive/negative rates\n6. **Data Handling** - What do they store? GDPR compliance?\n\n## Data We Need From Provider\n- Full legal name\n- Nationality/country of document\n- Verification status (passed/failed)\n\n## Deliverable\nCreate docs/ID_VERIFICATION_EVALUATION.md with comparison matrix and recommendation.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:04.862102Z","created_by":"James Campbell","updated_at":"2026-01-12T16:31:05.730128Z"}
{"id":"pnyx-7z7","title":"Implement document version history storage","status":"tombstone","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:15.65547Z","created_by":"James Campbell","updated_at":"2026-01-12T16:22:21.918017Z","deleted_at":"2026-01-12T16:22:21.918017Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"pnyx-9dq","title":"Build document diff view UI","status":"tombstone","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:15.779035Z","created_by":"James Campbell","updated_at":"2026-01-12T16:22:21.918017Z","deleted_at":"2026-01-12T16:22:21.918017Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"pnyx-ald","title":"Rebrand ForumMagnum to Pnyx","description":"Rebrand ForumMagnum to Pnyx throughout the codebase.\n\n## About the Name\nPnyx (pronounced 'niks') was the hill in Athens where citizens gathered to debate and vote - the birthplace of democracy. It embodies our mission of public, accountable discourse.\n\n## Rebranding Checklist\n\n### Visual\n- [ ] Logo (create simple text logo initially)\n- [ ] Favicon\n- [ ] Color scheme (choose something distinct from LessWrong green)\n- [ ] Site title in browser tab\n\n### Text\n- [ ] Site name in UI\n- [ ] Footer text\n- [ ] Email templates\n- [ ] Error messages\n- [ ] Meta tags for SEO\n\n### Technical\n- [ ] Package name in package.json\n- [ ] Docker image names\n- [ ] Environment variable prefixes (if any)\n- [ ] Database name (pnyx vs lesswrong)\n\n### Legal\n- [ ] Update or remove existing terms of service\n- [ ] Update or remove existing privacy policy\n- [ ] Add GPLv3 license notice (required since we're forking)\n\n## Notes\n- Don't spend too long on visual design - functional is fine for MVP\n- Keep LessWrong attribution as required by GPLv3","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:04.616279Z","created_by":"James Campbell","updated_at":"2026-01-12T16:30:37.695188Z","dependencies":[{"issue_id":"pnyx-ald","depends_on_id":"pnyx-1fo","type":"blocks","created_at":"2026-01-12T16:02:23.981555Z","created_by":"James Campbell"}]}
{"id":"pnyx-cfh","title":"Verify full flow: local dev â†’ build â†’ deploy â†’ running site","description":"End-to-end verification that the full development and deployment pipeline works.\n\n## Why This Matters\nBefore building features, we need confidence that:\n- A developer can clone and run locally\n- Changes can be deployed to production\n- The full flow works without surprises\n\n## Verification Checklist\n\n### Local Development\n- [ ] Clone repo\n- [ ] Run docker-compose up\n- [ ] Site loads at localhost:3000\n- [ ] Can create account\n- [ ] Can create post\n- [ ] Can add comment\n\n### Deployment (Railway OR Fly.io)\n- [ ] Push to GitHub triggers deploy\n- [ ] Deploy completes without errors\n- [ ] Site accessible at public URL\n- [ ] Can create account on deployed site\n- [ ] Can create post on deployed site\n- [ ] Database persists across deploys\n\n### Developer Experience\n- [ ] README has clear setup instructions\n- [ ] Environment variables documented\n- [ ] Common errors and solutions documented\n\n## Success Criteria\nA new developer can go from zero to deployed site in under 1 hour following the docs.\n\n## Deliverable\nUpdate README.md with verified setup instructions.","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:22:12.267419Z","created_by":"James Campbell","updated_at":"2026-01-12T16:29:52.576499Z","dependencies":[{"issue_id":"pnyx-cfh","depends_on_id":"pnyx-m6c","type":"blocks","created_at":"2026-01-12T16:22:17.226286Z","created_by":"James Campbell"},{"issue_id":"pnyx-cfh","depends_on_id":"pnyx-dk3","type":"blocks","created_at":"2026-01-12T16:22:17.28125Z","created_by":"James Campbell"}]}
{"id":"pnyx-dk3","title":"Create Fly.io deployment configuration","description":"Create Fly.io deployment configuration as an alternative to Railway.\n\n## Why Fly.io\n- Edge deployment (servers close to users globally)\n- Good free tier\n- More control than Railway\n- Supports Docker natively\n\n## Steps\n1. Create fly.toml configuration\n2. Configure Fly Postgres or external MongoDB\n3. Set up secrets for environment variables\n4. Test deployment with: fly deploy\n\n## Configuration Example (fly.toml)\n```toml\napp = 'pnyx'\nprimary_region = 'lhr'\n\n[build]\n  dockerfile = 'Dockerfile'\n\n[http_service]\n  internal_port = 3000\n  force_https = true\n  auto_stop_machines = true\n  auto_start_machines = true\n\n[env]\n  NODE_ENV = 'production'\n```\n\n## MongoDB Options\n1. Use Fly Postgres (not ideal for Mongo-native app)\n2. Use MongoDB Atlas free tier\n3. Use Fly Machine running MongoDB (more complex)\n\nRecommend: MongoDB Atlas free tier for simplicity\n\n## Success Criteria\n- fly deploy completes successfully\n- Site accessible at pnyx.fly.dev\n- Database connected and working\n- Can create accounts and posts","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:05:06.401277Z","created_by":"James Campbell","updated_at":"2026-01-12T16:29:42.185006Z","dependencies":[{"issue_id":"pnyx-dk3","depends_on_id":"pnyx-y4o","type":"blocks","created_at":"2026-01-12T16:05:20.706854Z","created_by":"James Campbell"}]}
{"id":"pnyx-e5i","title":"Write self-hosting documentation","status":"open","priority":3,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:05:06.591603Z","created_by":"James Campbell","updated_at":"2026-01-12T16:05:06.591603Z","dependencies":[{"issue_id":"pnyx-e5i","depends_on_id":"pnyx-y4o","type":"blocks","created_at":"2026-01-12T16:05:20.805019Z","created_by":"James Campbell"}]}
{"id":"pnyx-e63","title":"Create Dockerfile for Pnyx","description":"Create a Dockerfile to containerize the Pnyx application.\n\n## Why\nContainerization enables:\n- Consistent environments across dev/staging/prod\n- Easy deployment to any cloud provider\n- Other developers can run with one command\n- Required for Railway, Fly.io, and other PaaS deployments\n\n## Steps\n1. Study ForumMagnum's existing Docker setup (if any)\n2. Create multi-stage Dockerfile:\n   - Stage 1: Build (install deps, compile TypeScript)\n   - Stage 2: Production (slim image with only runtime deps)\n3. Ensure MongoDB connection works via environment variables\n4. Test locally with: docker build -t pnyx . \u0026\u0026 docker run -p 3000:3000 pnyx\n\n## Key Considerations\n- Use node:18-alpine or similar slim base image\n- Don't include dev dependencies in final image\n- Expose the correct port (check what ForumMagnum uses)\n- Handle environment variables for MongoDB URI, etc.\n\n## Success Criteria\n- docker build completes without errors\n- docker run starts the application\n- Can access the site at localhost:3000 (or configured port)","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:05:05.952529Z","created_by":"James Campbell","updated_at":"2026-01-12T16:29:16.689807Z","dependencies":[{"issue_id":"pnyx-e63","depends_on_id":"pnyx-nnw","type":"blocks","created_at":"2026-01-12T16:22:08.196007Z","created_by":"James Campbell"}]}
{"id":"pnyx-e8h","title":"Display 'First L., Country' on all posts and comments","description":"Display verified identity on all posts and comments.\n\n## Format\nEvery post and comment should show the author as:\n```\nJohn S., United Kingdom\n```\n\nFormat: {First Name} {Last Initial}., {Nationality}\n\n## Implementation\n\n### Component Changes\nFind the user display components (likely UserName, AuthorName, or similar) and modify to show verified identity instead of username.\n\n### Where to Display\n- Post author byline\n- Comment author\n- User profile header\n- User hover cards/tooltips\n- Notification senders\n\n### Fallback Handling\n- If user is not verified: show 'Unverified User' or block display\n- If verification pending: show 'Verification Pending'\n\n### Design Considerations\n- Use consistent styling across all locations\n- Consider adding a small verified checkmark icon\n- Nationality could use flag emoji: 'John S. ðŸ‡¬ðŸ‡§'\n\n### GraphQL Changes\nEnsure the displayIdentity field is exposed in GraphQL and fetched wherever user info is needed.\n\n## Testing\n- Create a verified test user\n- Check all locations where usernames appear\n- Verify the format is consistent everywhere","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:15.407546Z","created_by":"James Campbell","updated_at":"2026-01-12T16:31:39.718303Z","dependencies":[{"issue_id":"pnyx-e8h","depends_on_id":"pnyx-x6e","type":"blocks","created_at":"2026-01-12T16:02:24.383973Z","created_by":"James Campbell"}]}
{"id":"pnyx-gt2","title":"Document ForumMagnum database schema","description":"Document the MongoDB database schema used by ForumMagnum.\n\n## Why\nUnderstanding the data model is essential before:\n- Modifying user accounts for ID verification\n- Adding Arweave backup functionality\n- Removing LessWrong-specific features\n\n## What to Document\n\n### Core Collections (likely)\n- users - User accounts, profiles, karma\n- posts - Main content (articles/discussions)\n- comments - Threaded comments on posts\n- votes - Upvotes/downvotes on posts and comments\n- notifications - User notifications\n- conversations - Private messages (if any)\n\n### For Each Collection\n- Field names and types\n- Required vs optional fields\n- Indexes\n- Relationships to other collections\n\n## How to Explore\n1. Check for schema definitions in the codebase (look for Mongoose models or similar)\n2. Use MongoDB Compass to browse actual data\n3. Check GraphQL schema definitions\n\n## Deliverable\nCreate docs/DATABASE_SCHEMA.md with:\n- Collection diagrams\n- Field documentation\n- Key relationships\n- Notes on what we'll need to modify for Pnyx","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:01:44.173073Z","created_by":"James Campbell","updated_at":"2026-01-12T16:30:04.462464Z","dependencies":[{"issue_id":"pnyx-gt2","depends_on_id":"pnyx-nnw","type":"blocks","created_at":"2026-01-12T16:01:55.205041Z","created_by":"James Campbell"}]}
{"id":"pnyx-hhf","title":"Integrate government ID verification at signup","description":"Integrate the chosen ID verification provider into the Pnyx signup flow.\n\n## Context\nAfter evaluating providers (pnyx-6m3), implement the chosen solution.\n\n## User Flow\n1. User clicks 'Sign Up'\n2. User enters email (for account recovery/notifications only)\n3. User is redirected to ID verification flow\n4. User scans their government ID\n5. User takes a selfie for liveness check\n6. Provider verifies and returns result\n7. On success: account created with verified name + nationality\n8. On failure: show error, allow retry\n\n## Implementation Steps\n\n### Backend\n1. Add provider SDK to dependencies\n2. Create API endpoint to initiate verification\n3. Create webhook handler for verification results\n4. Store verification status and extracted data in user model\n5. Add fields to user schema:\n   - verifiedFirstName: string\n   - verifiedLastName: string\n   - verifiedNationality: string\n   - verificationStatus: 'pending' | 'verified' | 'failed'\n   - verificationId: string (provider's reference)\n\n### Frontend\n1. Replace existing signup form\n2. Embed provider's verification widget/SDK\n3. Handle success/failure callbacks\n4. Show verification status on profile\n\n## Security Considerations\n- Webhook signature verification\n- Don't store full ID images (let provider handle)\n- Rate limit verification attempts\n- Log verification attempts for audit\n\n## Testing\n- Use provider's sandbox/test mode\n- Test with sample documents\n- Test failure cases","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:04.979646Z","created_by":"James Campbell","updated_at":"2026-01-12T16:31:19.502901Z","dependencies":[{"issue_id":"pnyx-hhf","depends_on_id":"pnyx-6m3","type":"blocks","created_at":"2026-01-12T16:02:24.18846Z","created_by":"James Campbell"}]}
{"id":"pnyx-hx6","title":"Create restore CLI tool - download backup from Arweave","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:03:10.731732Z","created_by":"James Campbell","updated_at":"2026-01-12T16:04:16.250267Z","dependencies":[{"issue_id":"pnyx-hx6","depends_on_id":"pnyx-llk","type":"blocks","created_at":"2026-01-12T16:03:19.157298Z","created_by":"James Campbell"}]}
{"id":"pnyx-iwh","title":"Create fork-this-community workflow","status":"open","priority":3,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:05:12.576945Z","created_by":"James Campbell","updated_at":"2026-01-12T16:05:12.576945Z","dependencies":[{"issue_id":"pnyx-iwh","depends_on_id":"pnyx-e5i","type":"blocks","created_at":"2026-01-12T16:05:27.274449Z","created_by":"James Campbell"}]}
{"id":"pnyx-jbs","title":"Test full backup-destroy-restore cycle","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:05:12.457231Z","created_by":"James Campbell","updated_at":"2026-01-12T16:05:12.457231Z","dependencies":[{"issue_id":"pnyx-jbs","depends_on_id":"pnyx-6gk","type":"blocks","created_at":"2026-01-12T16:05:27.179519Z","created_by":"James Campbell"}]}
{"id":"pnyx-ks6","title":"Add Document as first-class content type","status":"tombstone","priority":2,"issue_type":"feature","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:15.524599Z","created_by":"James Campbell","updated_at":"2026-01-12T16:22:21.918017Z","deleted_at":"2026-01-12T16:22:21.918017Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"pnyx-lig","title":"Build document changelog display","status":"tombstone","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:15.890489Z","created_by":"James Campbell","updated_at":"2026-01-12T16:22:21.918017Z","deleted_at":"2026-01-12T16:22:21.918017Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"pnyx-llk","title":"Create backup manifest file on Arweave","description":"Create and maintain a backup manifest file on Arweave.\n\n## Purpose\nThe manifest is a pointer to the latest backup, stored on Arweave itself. It allows anyone to discover the most recent backup without external dependencies.\n\n## How It Works\n1. After each backup upload, update the manifest\n2. Manifest points to latest backup + history\n3. Manifest itself is uploaded to Arweave (new TX each time)\n4. ENS record points to latest manifest TX\n\n## Manifest Format\n```json\n{\n  \"version\": \"1.0\",\n  \"app\": \"Pnyx\",\n  \"latest\": {\n    \"txId\": \"abc123...\",\n    \"timestamp\": \"2024-01-15T00:00:00Z\",\n    \"checksum\": \"sha256:...\",\n    \"size_bytes\": 12345678\n  },\n  \"history\": [\n    {\n      \"txId\": \"xyz789...\",\n      \"timestamp\": \"2024-01-14T00:00:00Z\"\n    },\n    {\n      \"txId\": \"def456...\",\n      \"timestamp\": \"2024-01-13T00:00:00Z\"\n    }\n  ],\n  \"previous_manifest\": \"prev-manifest-txid...\"\n}\n```\n\n## Implementation\n```typescript\nasync function updateManifest(newBackupTxId: string, metadata: BackupMetadata): Promise\u003cstring\u003e {\n  // 1. Fetch current manifest (if exists)\n  // 2. Add new backup to history\n  // 3. Update 'latest' pointer\n  // 4. Upload new manifest to Arweave\n  // 5. Return new manifest TX ID\n}\n```\n\n## Tags for Discoverability\n```typescript\ntags: [\n  { name: 'App-Name', value: 'Pnyx' },\n  { name: 'Type', value: 'manifest' },\n  { name: 'Content-Type', value: 'application/json' },\n]\n```\n\n## Deliverable\nCreate src/backup/manifest.ts with manifest management functions.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:42.929196Z","created_by":"James Campbell","updated_at":"2026-01-12T16:32:37.131597Z","dependencies":[{"issue_id":"pnyx-llk","depends_on_id":"pnyx-44q","type":"blocks","created_at":"2026-01-12T16:02:56.97279Z","created_by":"James Campbell"}]}
{"id":"pnyx-m6c","title":"Create Railway deployment template","description":"Create Railway deployment configuration for one-click cloud deployment.\n\n## Why Railway\n- Simple PaaS with generous free tier\n- Automatic deployments from GitHub\n- Built-in MongoDB addon\n- Good for getting a public URL quickly\n\n## Steps\n1. Create railway.json or railway.toml configuration\n2. Configure build settings (Dockerfile or Nixpacks)\n3. Set up environment variables template\n4. Configure MongoDB addon\n5. Test deployment\n\n## Configuration Example (railway.toml)\n```toml\n[build]\nbuilder = 'dockerfile'\ndockerfilePath = './Dockerfile'\n\n[deploy]\nhealthcheckPath = '/'\nhealthcheckTimeout = 100\nrestartPolicyType = 'on_failure'\nrestartPolicyMaxRetries = 3\n```\n\n## Environment Variables Needed\n- MONGO_URL (from Railway MongoDB addon)\n- NODE_ENV=production\n- Any other ForumMagnum-specific vars\n\n## Success Criteria\n- Deploy button works from GitHub\n- Site is accessible at railway.app subdomain\n- MongoDB addon provisioned and connected\n- Application logs visible in Railway dashboard","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:05:06.215417Z","created_by":"James Campbell","updated_at":"2026-01-12T16:29:33.921648Z","dependencies":[{"issue_id":"pnyx-m6c","depends_on_id":"pnyx-y4o","type":"blocks","created_at":"2026-01-12T16:05:20.407633Z","created_by":"James Campbell"}]}
{"id":"pnyx-mgq","title":"Add manual backup trigger for admins","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:49.573282Z","created_by":"James Campbell","updated_at":"2026-01-12T16:04:16.251139Z","dependencies":[{"issue_id":"pnyx-mgq","depends_on_id":"pnyx-44q","type":"blocks","created_at":"2026-01-12T16:03:03.462588Z","created_by":"James Campbell"}]}
{"id":"pnyx-nnw","title":"Get ForumMagnum local dev environment running","description":"Get the ForumMagnum codebase running locally so you can develop and test.\n\n## Prerequisites\n- Node.js (check their package.json for version)\n- MongoDB running locally or via Docker\n- Yarn or npm\n\n## Steps\n1. Follow the README setup instructions\n2. Install dependencies\n3. Set up local MongoDB instance\n4. Configure environment variables\n5. Run the development server\n6. Verify you can access the site at localhost\n\n## Success Criteria\n- Site loads in browser\n- Can create a test account\n- Can create a test post\n- Can add comments\n\n## Common Issues\n- MongoDB connection errors - ensure MongoDB is running\n- Node version mismatches - use nvm to match their version\n- Missing environment variables - check .env.example\n\n## Notes\nThis step is critical - we need local dev working before we can containerize or customize anything.","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:01:44.036739Z","created_by":"James Campbell","updated_at":"2026-01-12T16:29:09.0077Z","dependencies":[{"issue_id":"pnyx-nnw","depends_on_id":"pnyx-689","type":"blocks","created_at":"2026-01-12T16:01:55.115706Z","created_by":"James Campbell"}]}
{"id":"pnyx-o4t","title":"Create restore CLI tool - verify backup integrity","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:03:10.844531Z","created_by":"James Campbell","updated_at":"2026-01-12T16:04:16.249135Z","dependencies":[{"issue_id":"pnyx-o4t","depends_on_id":"pnyx-hx6","type":"blocks","created_at":"2026-01-12T16:03:19.255389Z","created_by":"James Campbell"}]}
{"id":"pnyx-t6m","title":"Create restore CLI tool - hydrate MongoDB from backup","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:03:10.962452Z","created_by":"James Campbell","updated_at":"2026-01-12T16:04:16.245515Z","dependencies":[{"issue_id":"pnyx-t6m","depends_on_id":"pnyx-o4t","type":"blocks","created_at":"2026-01-12T16:03:19.350482Z","created_by":"James Campbell"}]}
{"id":"pnyx-x6e","title":"Store verified name and nationality in user model","description":"Store verified identity data in the user model.\n\n## Context\nAfter ID verification succeeds, we need to store the verified name and nationality in MongoDB.\n\n## Schema Changes\nAdd to user model:\n```typescript\n{\n  // Existing fields...\n  \n  // New identity fields\n  verifiedFirstName: String,      // e.g., 'John'\n  verifiedLastName: String,       // e.g., 'Smith'\n  verifiedNationality: String,    // e.g., 'United Kingdom'\n  \n  // Verification metadata\n  verificationStatus: {\n    type: String,\n    enum: ['unverified', 'pending', 'verified', 'failed'],\n    default: 'unverified'\n  },\n  verificationProvider: String,   // e.g., 'persona', 'onfido'\n  verificationId: String,         // Provider's reference ID\n  verifiedAt: Date,               // When verification completed\n}\n```\n\n## Display Name Generation\nCreate a computed/virtual field:\n```typescript\ndisplayIdentity: function() {\n  if (this.verificationStatus !== 'verified') return null;\n  const lastInitial = this.verifiedLastName?.charAt(0) || '';\n  return `${this.verifiedFirstName} ${lastInitial}., ${this.verifiedNationality}`;\n  // e.g., 'John S., United Kingdom'\n}\n```\n\n## Migration\n- Existing users (if any) should be marked as 'unverified'\n- They'll need to verify to continue posting\n\n## Privacy Note\n- Email is NOT included in Arweave backups\n- Verified name + nationality ARE included (users consent at signup)\n- Full last name is stored but only initial is displayed","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:05.095732Z","created_by":"James Campbell","updated_at":"2026-01-12T16:31:29.925389Z","dependencies":[{"issue_id":"pnyx-x6e","depends_on_id":"pnyx-hhf","type":"blocks","created_at":"2026-01-12T16:02:24.285522Z","created_by":"James Campbell"}]}
{"id":"pnyx-y4o","title":"Create Docker Compose configuration","description":"Create Docker Compose configuration for local development and self-hosting.\n\n## Why\nDocker Compose allows running the full stack (app + MongoDB) with one command:\n```\ndocker-compose up\n```\n\n## Components to Include\n1. **pnyx** - The main application (uses our Dockerfile)\n2. **mongodb** - Database (use official mongo image)\n3. **Optional: mongo-express** - Web UI for MongoDB debugging\n\n## Configuration\n```yaml\nversion: '3.8'\nservices:\n  pnyx:\n    build: .\n    ports:\n      - '3000:3000'\n    environment:\n      - MONGO_URL=mongodb://mongodb:27017/pnyx\n    depends_on:\n      - mongodb\n  \n  mongodb:\n    image: mongo:6\n    volumes:\n      - mongodb_data:/data/db\n    ports:\n      - '27017:27017'\n\nvolumes:\n  mongodb_data:\n```\n\n## Success Criteria\n- `docker-compose up` starts both services\n- App connects to MongoDB successfully\n- Data persists across restarts (volume mount works)\n- Can access site at localhost:3000","status":"open","priority":1,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:05:06.089207Z","created_by":"James Campbell","updated_at":"2026-01-12T16:29:24.288682Z","dependencies":[{"issue_id":"pnyx-y4o","depends_on_id":"pnyx-e63","type":"blocks","created_at":"2026-01-12T16:05:20.290101Z","created_by":"James Campbell"}]}
{"id":"pnyx-zws","title":"Integrate Irys SDK for Arweave uploads","description":"Integrate the Irys SDK for uploading data to Arweave.\n\n## Why Irys\nIrys (formerly Bundlr) is a layer on top of Arweave that provides:\n- Cheaper uploads (batches transactions)\n- Faster confirmations\n- Better developer experience\n- Still permanently stored on Arweave\n\n## Installation\n```bash\nnpm install @irys/sdk\n```\n\n## Basic Setup\n```typescript\nimport Irys from '@irys/sdk';\n\nconst irys = new Irys({\n  url: 'https://node1.irys.xyz', // or node2\n  token: 'ethereum', // or 'matic', 'arweave', etc.\n  key: process.env.IRYS_PRIVATE_KEY,\n});\n\n// Check balance\nconst balance = await irys.getLoadedBalance();\n\n// Fund account (needed before uploading)\nawait irys.fund(irys.utils.toAtomic(0.1)); // 0.1 tokens\n\n// Upload data\nconst receipt = await irys.upload(data, {\n  tags: [\n    { name: 'Content-Type', value: 'application/json' },\n    { name: 'App-Name', value: 'Pnyx' },\n  ],\n});\n\nconsole.log('Uploaded to:', `https://arweave.net/${receipt.id}`);\n```\n\n## Environment Variables\n- IRYS_PRIVATE_KEY: Wallet private key for payments\n- IRYS_NODE: Which Irys node to use\n\n## Cost Estimation\n- Approximately -8 per GB\n- Check current prices: https://irys.xyz/pricing\n\n## Deliverable\nCreate a utility module: src/lib/arweave.ts with upload helper functions.","status":"open","priority":2,"issue_type":"task","owner":"james.campbell@tanti.org.uk","created_at":"2026-01-12T16:02:42.699686Z","created_by":"James Campbell","updated_at":"2026-01-12T16:31:51.010317Z"}
